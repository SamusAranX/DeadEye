<Window x:Class="DeadEye.Windows.ScreenshotFrameWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DeadEye"
        xmlns:controls="clr-namespace:DeadEye.Controls"
        Loaded="ScreenshotFrameWindow_OnLoaded"
        mc:Ignorable="d" WindowStyle="None" Background="Magenta" ResizeMode="NoResize" Icon="/Images/camera.ico"
        DataContext="{Binding RelativeSource={RelativeSource Self}}"
        Title="ScreenshotFrameWindow" Height="480" Width="640"
        KeyDown="ScreenshotFrameWindow_OnKeyDown" KeyUp="ScreenshotFrameWindow_OnKeyUp"
        LostFocus="ScreenshotFrameWindow_OnLostFocus"
        TextOptions.TextHintingMode="Fixed" TextOptions.TextFormattingMode="Display" UseLayoutRounding="True"
        Typography.NumeralAlignment="Tabular" Typography.NumeralStyle="Lining" Cursor="Cross"
        MouseLeftButtonDown="ScreenshotFrameWindow_OnMouseLeftButtonDown" MouseMove="ScreenshotFrameWindow_OnMouseMove"
        MouseLeftButtonUp="ScreenshotFrameWindow_OnMouseLeftButtonUp">
	<Grid>
		<Image Source="{Binding ScreenshotSource}" />

		<!-- Explicitly repeating the DataContext here because WPF is shit like that -->
		<controls:PassepartoutView CutoutRect="{Binding SelectionBounds}"
		                           DataContext="{Binding RelativeSource={RelativeSource AncestorType=Window}}" />

		<Canvas Background="Transparent">
			<controls:GuideGrid x:Name="GuideGrid"
			                    GridOpacity="0.6"
			                    GridType="{Binding Source={x:Static local:Settings.SharedSettings}, Path=SharedSettings.GridType}"
			                    MarkCenter="{Binding Source={x:Static local:Settings.SharedSettings}, Path=SharedSettings.MarkCenter}"
			                    Canvas.Top="{Binding SelectionBoundsClamped.Top}"
			                    Canvas.Left="{Binding SelectionBoundsClamped.Left}"
			                    Width="{Binding SelectionBoundsClamped.Width}"
			                    Height="{Binding SelectionBoundsClamped.Height}" />
		</Canvas>

		<Canvas Background="Transparent"
		        Visibility="{Binding
				Source={x:Static local:Settings.SharedSettings}, 
				Path=SharedSettings.ShowDimensions, 
				Converter={StaticResource BoolToVis}}">
			<controls:RectWHDisplay x:Name="RectDisplay"
			                        DataContext="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
			                        FontSize="{Binding Source={x:Static local:Settings.SharedSettings}, Path=SharedSettings.TextSize}"
			                        Canvas.Top="{Binding BoundsDisplayCoords.Y}"
			                        Canvas.Left="{Binding BoundsDisplayCoords.X}"
			                        DisplayRect="{Binding SelectionBoundsClamped}"
			                        Visibility="{Binding IsMakingSelection, Converter={StaticResource BoolToVis}}" />
		</Canvas>
	</Grid>
</Window>